function init(){var e,t;$(".task-bubble").off("hover").hover(function(){$(this).css({"background-color":"#eeeff0",cursor:"pointer"}),$(this).children().css({"background-color":"#eeeff0",cursor:"pointer"})},function(){$(this).css({"background-color":"white",cursor:"default"}),$(this).children().css({"background-color":"white",cursor:"default"})}),$(".task-bubble-input").off("focus").on("focus",function(){$(this).addClass("not"),$(".task-bubble-input:not(.not)").prop("disabled",!0),$(this).removeClass("not"),$(".team-member").removeClass("show"),$("#column-details").removeClass("show"),$("#add-column-btn").addClass("show"),$("#archive-btn").addClass("show"),$(".task-buttons-container").removeClass("show"),$("#check-comment-btn").removeClass("show"),$("#delete-comment-btn").removeClass("show"),$("#task-comment-container").children().remove(),$("#task-members-container").children().remove(),$("#attributed-member-button").removeClass("show"),$("#attribute-member-button").removeClass("show"),$("#desattribute-member-button").removeClass("show"),$(this).parent().next().find(".task-buttons-container").first().addClass("show"),columnId=$(this).parents(".project-column").first().find(".columnId-input").val(),taskDiv=$(this).parents(".task").first(),e=taskDiv.find(".taskId-input").val(),$("#up-task-btn").off("click").on("click",function(){$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=upTask&taskId="+e+"&columnId="+columnId+"&teamId="+teamId+"&projectId="+projectId,success:function(e){prevTask=taskDiv.prevAll(".task").first(),taskDiv.insertBefore(prevTask),$("#loading-modal").modal("hide")}})}),$("#down-task-btn").off("click").on("click",function(){$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=downTask&taskId="+e+"&columnId="+columnId+"&teamId="+teamId+"&projectId="+projectId,success:function(e){nextTask=taskDiv.nextAll(".task").first(),taskDiv.insertAfter(nextTask),$("#loading-modal").modal("hide")}})}),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=getTaskComments&taskId="+e+"&teamId="+teamId+"&projectId="+projectId,success:function(e){if(e=JSON.parse(e)){for(comments=e.comments,l=comments.length,i=0;i<l;i++){note=comments[i].note,note=null==note?"":note,admin=comments[i].admin,author=comments[i].author,authorId=comments[i].fk_user,tms=comments[i].tms;var t=["<div class='task-comment-div'>","<input type='hidden' class='comment-task-id' value='"+comments[i].rowid+"'>","<input type='hidden' class='comment-author-id' value='"+authorId+"'>","<textarea "].join("");0==comments[i].isAuthor&&(t+="readonly "),t+=["class='mt-3 card task-comment px-2 pt-3 text-center' name='' cols='30' rows='3'>",note,"</textarea>","<div class='mt-1'>","<div class='row w-100' style='margin-left:0'>","<div class='col-7 px-0'>","<button class='btn w-100 btn-unactive "].join(""),1==admin?t+="btn-outline-danger":t+="btn-outline-classic",t+=[" comment-author'>",author,"</button>","</div>","<div class='col-5 pe-0'>","<span class='w-100' style='color:grey;font-size:small'>",tms,"</span>","</div>","</div>","</div>"].join(""),$("#task-comment-container").prepend(t)}initComment()}}}),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=getTeamMembers&taskId="+e+"&teamId="+teamId+"&projectId="+projectId,success:function(a){$("#team-members-container").children().remove(),$("#task-members-container").children().remove();a=JSON.parse(a);affectedUsers=a.affectedUsers,affectedUsers.forEach(e=>{var t=["<div class='task-member'>","<input type='hidden' class='task-member-id' value='"+e.rowid+"'>","<input class='w-90 sticker mx-auto mt-2 hover text-center form-control "+(idUser==e.rowid?"underline":"")+"' readonly value='"+e.lastname+" "+e.firstname+"'>","</div>"].join("");$("#task-members-container").prepend(t);var a=["<div class='team-member collapse show'>","<input type='hidden' class='team-member-id' value='"+e.rowid+"'>","<input type='text' class='affected-team-member form-control sticker mx-auto mt-2 hover text-center w-90 "+(idUser==e.rowid?"underline":"")+"' readonly  value='"+e.lastname+" "+e.firstname+"'>","</div>"].join("");$("#team-members-container").append(a)}),freeUsers=a.freeUsers,freeUsers.forEach(e=>{var t=["<div class='team-member collapse show'>","<input type='hidden' class='team-member-id' value='"+e.rowid+"'>","<input type='text' class='form-control sticker mx-auto mt-2 hover text-center w-90 "+(idUser==e.rowid?"underline":"")+"' readonly  value='"+e.lastname+" "+e.firstname+"'>","</div>"].join("");$("#team-members-container").append(t)}),$(".team-member").off("click").on("click",function(){t=(t=$(this).find(".team-member-id").val()).replace('"'," ").replace('"'," "),memberName=$(this).find(".sticker").val(),$(this).find(".form-control").hasClass("affected-team-member")?($("#attributed-member-button").addClass("show"),$("#attribute-member-button").removeClass("show")):($("#attribute-member-button").addClass("show"),$("#attributed-member-button").removeClass("show"))}),$(".task-member").off("click").on("click",function(){t=(t=$(this).find(".task-member-id").val()).replace('"'," ").replace('"'," "),$("#desattribute-member-button").addClass("show")}),$("#attribute-member-button").off("click").on("click",function(){btn=$(this),0==$(".task-member-id[value='"+t+"']").length&&$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=attributeMemberToTask&taskId="+e+"&memberId="+t+"&teamId="+teamId+"&projectId="+projectId,success:function(e){$(".team-member-id[value='"+t+"']").nextAll(".form-control").first().addClass("affected-team-member"),btn.removeClass("show");var a=["<div class='task-member'>","<input type='hidden' class='task-member-id' value='"+t+"'>","<input class='w-90 sticker mx-auto mt-2 hover text-center form-control' readonly value='"+memberName+"'>","</div>"].join("");$("#task-members-container").prepend(a),$(".task-member").off("click").on("click",function(){t=(t=$(this).find(".task-member-id").val()).replace('"'," ").replace('"'," "),$("#desattribute-member-button").addClass("show")})}})}),$("#desattribute-member-button").off("click").on("click",function(){btn=$(this),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=desattributeMemberToTask&taskId="+e+"&memberId="+t+"&teamId="+teamId+"&projectId="+projectId,success:function(e){$(".team-member-id[value='"+t+"']").nextAll(".form-control").first().removeClass("affected-team-member"),btn.removeClass("show"),$(".task-member-id[value='"+t+"']").parent().remove()}})}),$(".team-member").addClass("show"),$(".task-bubble-input").prop("disabled",!1)}}),$("#task-details").addClass("show")}),initTask(),$("#add-comment-btn").off("click").on("click",function(){$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=addTaskComment&taskId="+e+"&teamId="+teamId+"&projectId="+projectId,success:function(e){var t=["<div class='task-comment-div'>","<input type='hidden' class='comment-task-id' value='"+e.replace('"'," ").replace('"'," ")+"'>","<input type='hidden' class='comment-author-id' value='"+idUser+"'>","<textarea class='mt-3 card task-comment px-2 pt-3 text-center' name='' cols='30' rows='3'></textarea>","<div class='d-flex justify-content-start mt-1'>","<button class='btn btn-outline-classic comment-author'>",username,"</button>","</div>","</div>"].join("");$("#task-comment-container").prepend(t),$("#loading-modal").modal("hide"),initComment()}})}),initComment(),$("#finish-task-button").on("click",function(){newColumn=taskDiv.parents(".project-column").nextAll(".project-column").last(),oldColumn=taskDiv.parents(".project-column").find(".column-title-text").val(),$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"admin/map.php?action=finishedTask&taskId="+e+"&teamId="+teamId+"&projectId="+projectId+"&oldColumn="+oldColumn,success:function(e){taskDiv.prependTo(newColumn.find(".column-content").first()),$("#loading-modal").modal("hide")}})})}function initTask(){$(".add-task-btn").off("click").on("click",function(){$("#add-column-btn").addClass("show"),$("#archive-btn").addClass("show"),addTaskBtn=$(this),columnId=addTaskBtn.parents(".column-title").prev().val(),$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=addTask&columnId="+columnId+"&teamId="+teamId+"&projectId="+projectId,success:function(e){$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=getLastTaskId&teamId="+teamId+"&projectId="+projectId,success:function(e){e=JSON.parse(e);taskId=e.rowid,taskId=taskId.replace('"'," ").replace('"'," ");var t=["<div class='task'>","<input class='taskId-input' type='hidden' value='"+taskId+"'>","<button class='btn btn-outline-classic disabled line-height-40 mt-2 ms-2 px-0 w-50 overflow-x'>",username,"</button>","<div class='task-bubble pt-2 mb-1 mt-1 mx-2'>","<textarea class='task-bubble-input text-center'></textarea>","</div>","<div class='d-flex justify-content-between pe-2 ps-2'>","<div class='collapse mx-auto task-buttons-container'>","<i class='bi bi-check-lg btn btn-outline-success task-check'></i>","<i class='bi bi-trash ms-1 btn btn-outline-danger task-delete'></i>","<i class='bi bi-caret-left-fill ms-1 btn btn-outline-dark arrow-img-btn task-to-left'></i>","<i class='bi bi-caret-right-fill ms-1 btn btn-outline-dark arrow-img-btn task-to-right'></i>","<i class='bi bi-archive-fill task-archive ms-1 me-1 btn btn-outline-danger'></i>","</div>","</div>","</div>"].join("");addTaskBtn.parents(".column-title").next().prepend(t),$("#loading-modal").modal("hide"),init()}})}})}),$(".task-check").off("click").on("click",function(){$(this).parent().removeClass("show"),taskName=$(this).parents(".task").find(".task-bubble").first().find(".task-bubble-input").val(),taskId=$(this).parents(".task").find(".taskId-input").first().val(),$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=updateTask&taskId="+taskId+"&taskName="+taskName+"&teamId="+teamId+"&projectId="+projectId,success:function(){$("#loading-modal").modal("hide")}})}),$(".task-delete").off("click").on("click",function(){$("#add-column-btn").addClass("show"),$("#archive-btn").addClass("show"),taskId=$(this).parents(".task").first().find(".taskId-input").val(),$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=deleteTask&taskId="+taskId+"&teamId="+teamId+"&projectId="+projectId,success:function(){$("#loading-modal").modal("hide")}}),task=$(this).parents(".task").first(),task.remove(),$("#task-details").removeClass("show")}),$(".task-to-left").on("click",function(){task=$(this).parents(".task"),taskId=task.find(".taskId-input").first().val(),newColumn=task.parents(".project-column").prevAll(".project-column").first(),updateTaskColumn(task,taskId,newColumn)}),$(".task-to-right").on("click",function(){task=$(this).parents(".task"),taskId=task.find(".taskId-input").first().val(),newColumn=task.parents(".project-column").nextAll(".project-column").first(),updateTaskColumn(task,taskId,newColumn)}),$(".task-archive").on("click",function(){task=$(this).parents(".task"),taskId=task.find(".taskId-input").first().val(),$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=archiveTask&taskId="+taskId+"&teamId="+teamId+"&projectId="+projectId,success:function(e){task.remove(),$("#loading-modal").modal("hide")}})})}function initCol(){var e;$(".column-title-name").off("click").on("click",function(){$("#task-details").removeClass("show"),$("#add-column-form").removeClass("show"),$("#column-details-check-btn").removeClass("visible").addClass("invisible"),$("#add-column-btn").addClass("show"),$("#archive-btn").addClass("show"),$("#column-details").addClass("show"),$("#column-title").val($(this).find(".column-title-text").first().text()),"Open"===$("#column-title").val()||"Closed"===$("#column-title").val()?($("#left-column-btn").addClass("collapse"),$("#right-column-btn").addClass("collapse"),$("#column-title").prop("disabled",!0),$("#column-details-delete-btn").addClass("collapse")):($("#left-column-btn").removeClass("collapse"),$("#right-column-btn").removeClass("collapse"),$("#column-title").prop("disabled",!1),$("#column-details-delete-btn").removeClass("collapse")),e=$(this).parents(".column-title").first().prevAll(".columnId-input").first().val()}),$(".delete-col-btn").off("click").on("click",function(){e=$(this).parents(".column-title").prev().val(),$(this).parents(".project-column").remove(),$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=deleteColumn&columnId="+e+"&teamId="+teamId+"&projectId="+projectId,success:function(){$("#column-details").removeClass("show"),$("#loading-modal").modal("hide")}})}),$("#left-column-btn").off("click").on("click",function(){$("#loading-modal").modal("show"),columnName=$("#column-title").val(),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=leftColumn&columnId="+e+"&teamId="+teamId+"&projectId="+projectId+"&columnName="+columnName,success:function(t){(t=JSON.parse(t))&&(column=$(".columnId-input[value='"+e+"']").parents(".project-column").first(),column.insertBefore(column.prevAll(".project-column").first())),$("#loading-modal").modal("hide")}})}),$("#right-column-btn").off("click").on("click",function(){$("#loading-modal").modal("show"),columnName=$("#column-title").val(),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=rightColumn&columnId="+e+"&teamId="+teamId+"&projectId="+projectId+"&columnName="+columnName,success:function(t){(t=JSON.parse(t))&&(column=$(".columnId-input[value='"+e+"']").parents(".project-column").first(),column.insertAfter(column.nextAll(".project-column").first())),$("#loading-modal").modal("hide")}})}),$("#column-details-delete-btn").off("click").on("click",function(){$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=deleteColumn&columnId="+e+"&teamId="+teamId+"&projectId="+projectId,success:function(){$(".columnId-input[value='"+e+"']").parents(".project-column").first().remove(),$("#column-details").removeClass("show"),$("#loading-modal").modal("hide")}})}),$("#column-details-check-btn").off("click").on("click",function(){$("#loading-modal").modal("show"),$("#column-details-check-btn").removeClass("visible").addClass("invisible"),columnName=$("#column-title").val(),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=updateColumn&columnId="+e+"&columnName="+columnName+"&teamId="+teamId+"&projectId="+projectId,success:function(t){(t=JSON.parse(t)).success&&($("#column-details-check-btn").removeClass("show"),$(".columnId-input[value='"+e+"']").nextAll(".column-title").first().find(".column-title-text").first().text(columnName)),$("#loading-modal").modal("hide")}})}),$("#column-title").off("focus").on("focus",function(){$("#column-details-check-btn").addClass("visible").removeClass("invisible")})}function initComment(){var e,t="";$(".task-comment").off("focus").on("focus",function(){commentAuthorId=$(this).prevAll(".comment-author-id").first().val(),commentAuthorId=commentAuthorId.replace('"'," ").replace('"'," "),commentAuthorId==idUser?($("#check-comment-btn").addClass("show"),$("#delete-comment-btn").addClass("show"),$("#add-comment-btn").removeClass("show")):($("#check-comment-btn").removeClass("show"),$("#delete-comment-btn").removeClass("show"),$("#add-comment-btn").addClass("show")),e=(e=$(this).prevAll(".comment-task-id").first().val()).replace('"'," ").replace('"'," ")}),$(".task-comment").off("keyup").keyup(function(){t=$(this).val()}),$("#check-comment-btn").off("click").on("click",function(){$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=updateTaskNote&commentId="+e+"&taskNote="+t+"&teamId="+teamId+"&projectId="+projectId,success:function(e){$("#check-comment-btn").removeClass("show"),$("#delete-comment-btn").removeClass("show"),$("#add-comment-btn").addClass("show"),$("#loading-modal").modal("hide")}})}),$("#delete-comment-btn").off("click").on("click",function(){$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=deleteTaskNote&commentId="+e+"&teamId="+teamId+"&projectId="+projectId,success:function(t){$("#check-comment-btn").removeClass("show"),$("#delete-comment-btn").removeClass("show"),$("#add-comment-btn").addClass("show"),$(".comment-task-id[value='"+e+"']").parents(".task-comment-div").first().remove(),$("#loading-modal").modal("hide")}})})}function updateTaskColumn(e,t,a){newColumnId=0!=a.length&&a.find(".columnId-input").first().val(),newColumnId&&($("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=taskColumnUpdate&taskId="+t+"&columnId="+newColumnId+"&teamId="+teamId+"&projectId="+projectId,success:function(t){e.prependTo(a.find(".column-content").first()),$("#loading-modal").modal("hide")}}))}$("body").css("overflow-y","hidden"),init(),initCol(),$("#add-column-btn").on("click",function(){$("#archive-btn").removeClass("show"),$("#add-column-form").toggleClass("show"),$("#task-details").removeClass("show"),$("#column-details").removeClass("show"),$(this).toggleClass("show")}),$("#cancel-column").on("click",function(){$("#add-column-form").toggleClass("show"),$("#add-column-btn").toggleClass("show"),$("#archive-btn").addClass("show")}),$("#archive-btn").on("click",function(){$("#columns-container").parent().removeClass("show"),$("#details-section").removeClass("show"),$("#archive-confirmation").addClass("show")}),$("#cancel-archive").on("click",function(){$("#columns-container").parent().addClass("show"),$("#details-section").addClass("show"),$("#archive-confirmation").removeClass("show")}),$("#close-details").on("click",function(){$(this).removeClass("show"),$("#details-section").removeClass("show"),$("#left-section").removeClass("col-sm-8 col-md-9 col-lg-10").addClass("col-12"),$("#open-right-section").addClass("show")}),$("#open-right-section").on("click",function(){$("#close-details").addClass("show"),$("#details-section").addClass("show"),$("#left-section").removeClass("col-12").addClass("col-sm-8 col-md-9 col-lg-10"),$(this).removeClass("show")}),$("#members-switch-button").off("click").on("click",function(){$(".members-label").toggleClass("show"),$("#team-members-container").toggleClass("show"),$("#task-members-container").toggleClass("show"),$("#desattribute-member-button").removeClass("show"),$("#attribute-member-button").removeClass("show"),$("#attributed-member-button").removeClass("show")}),$(".close-alert").on("click",function(){$(this).parent().removeClass("show alert-visible")}),$("#add-column-form").find("#create-column").on("click",function(){$("#archive-btn").addClass("show"),$("#add-column-form").removeClass("show"),columnName=$("#columnName-input").val(),columnName=0==columnName.length?" ":columnName,columnNameInput=$(this).prev(),btnColumnForm=$(this),$("#loading-modal").modal("show"),$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=addColumn&columnName="+columnName+"&teamId="+teamId+"&projectId="+projectId,success:function(e){$.ajax({async:!0,url:AJAX_URL+"membre/map.php?action=getLastColumnId&teamId="+teamId+"&projectId="+projectId,success:function(t){if((e=JSON.parse(e)).success){columnId=t,columnId=columnId.replace('"',"").replace('"',""),columnNameInput.val(""),btnColumnForm.addClass("show");var a=["<div class='project-column'>","<input class='columnId-input' type='hidden' value='"+columnId+"'>","<div class='column-title text-center'>","<div class='row'>","<div class='col-7 pt-3 ps-2 ms-3 pe-0 column-title-name'>","<div class='overflow-x'>","<b class='column-title-text'>",columnName,"</b>","</div>","</div>","<ul class='offset-1 col-3 pt-2 ps-0'>","<li class='me-2'>","<button class='btn btn-outline-dark add-task-btn'>","New","</button>","</li>","<li class='mt-2 me-2'>","<button class='btn btn-outline-danger delete-col-btn'>","Delete","</button>","</li>","</ul>","</div>","</div>","<div class='column-content'>","</div>","</div>"].join("");$("#columns-container").append(a),$("#add-column-btn").toggleClass("show"),initTask(),initCol(),column=$(".columnId-input[value='"+columnId+"']").parents(".project-column").first(),column.insertBefore(column.prevAll(".project-column").first())}$("#loading-modal").modal("hide")}})}})});